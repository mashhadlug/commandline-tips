# ساختن سرویس ها در SystemD :


برای ساختن service در SystemD باید به ازای هر سرویس یک فایل با پسوند .service درست کنیم. مثلا myservice.service و داخل اون تنظیمات service رو می نویسیم. و باید این فایل رو داخل 
یکی از دایرکتوری های

/etc/systemd/system.control/

/run/systemd/system.control/

/run/systemd/transient/

/run/systemd/generator.early/

/etc/systemd/system/

/etc/systemd/system.attached/

/run/systemd/system/

/run/systemd/system.attached/

/run/systemd/generator/

/usr/lib/systemd/system/

/run/systemd/generator.late/


قرار بدیم.
بیشتر سرویس ها در داخل دایرکتوری /usr/lib/systemd/system/ هستن و در این مثال ما فایل سرویس خودمون رو اینجا ایجاد می کنیم.

در داخل فایل یکسری تنظیمات و پارامتر ها هستن که باید به درستی نوشته بشن تا SystemD بتونه سرویس ما رو اجرا کنه. هر فایل سرویس از سه بخش تشکیل شده Unit , Service , Install 
در ادامه به بعضی از پارامتر های کاربردی هر بخش به همراه توضیحات اشاره می کنیم. دقتت کنید که در همه موارد حروف کوچک و بزرگ مهم هستن.


# بخش [Unit] :

Description=

در این بخش جلوی علامت = میتونیم یک توضیحات کلی درباره سرویس بنویسیم. این توضیحات موقعی که از سرویس status بگیریم نمایش داده میشن.

Requires= و Wants=


با استفاده از Requires= و Wants= میتونیم برای service مون dependency ایجاد کنیم. و اسم هر تعداد سرویس رو که جلوی Requires= یا Wants= بیاریم یعنی سرویس ما به اون سرویس ها وابستگی داره . و وقتی سرویس ما اجرا بشه اون سرویس ها هم همزمان با اون به صورت خودکار اجرا میشن.
فرقی که Requires= با Wants= داره اینکه در حالت Requires اگه سرویس های dependency اجرا نشن سرویس ما هم نمیتونه اجرا بشه و fail میشه. ولی در حالت Wants اگه سرویس های dependency اجرا نشن سرویس ما به کارش ادامه میده.

 

Before= و After=

همون طور که گفتم اگه از Wants یا Requires استفاده کنیم dependency های یک سرویس همزمان با خودش اجرا میشن. حالا با استفاده از Before و After میتونیم برای اجراشدن این سرویس ها الویت بندی کنیم و بگیم که سرویس اصلی ما قبل و یا بعد از کدوم سرویس اجرا بشه.


# بخش [Service]:

ExecStart=

این پارامتر مهم ترین پارامتر در سرویس ما هست. جلوی پارامتر ExecStart باید آدرس دقیق اسکریپت یا دستوری روی که میخایم سرویس ما اجرا بکنه رو بنویسیم. درواقع کار اصلی سرویس ما این هست که این برنامه یا اسکریپت که اینجا براش مشخص میکنیم رو اجرا بکنه.


ExecStartPre= و ExecStartPost=

با استفاده از این دوتا پارامتر هم میتونیم برنامه یا اسکریپتی رو مشخص کنیم که باید قبل یا بعد از اجرا شدن ExecStart اجرا بشه.


# بخش [Install]:

پارامتر های این بخش زمانی بررسی میشن که این سرویس بخاد در هنگام بوت شدن سیستم به طور خودکار اجرا بشه. وقتی شما با استفاده از دستور systemctl یک سرویس رو enable کنید این اتفاق میوفته.
WantedBy= 

جلوی این پارامتر باید مشخص کنیم که سرویس اصلی ما بعد از اجرا شدن چه سرویسی در هنگام بوت شدن سیستم اجرا بشه. مثلا میتونیم جلوش بنویسیم graphical.target و این یعنی هر زمان سیستم در حالت یا ران لول گرافیکی بوت شد این سرویس اجرا بشه.

یا مثلا میتونیم بنویسیم network.service و یعنی در هنگام بوت شدن سیستم بعد از اجراشدن سرویس network سرویس ما هم اجرا بشه.
پس اگر سرویس enable بشه و پارامتر WantedBy رو هم نداشته باشه تحت هر شرایطی هنگام بوت شدن سیستم عامل اجرا میشه.



# یک نمونه ساده از محتویات یک Sevice file :


[Unit]
Description= this is a test service

[Service]
ExecStart=/home/neuron/script.sh

[Install]
WantedBy=graphical.target


بعد از اینکه فایل سرویس رو نوشتیم و در یکی از دایرکتوری هایی که در بالا گفته شد قرار دادیم باید دستورsystemctl daemon-reload رو اجرا بکنیم. با این کار systemD دوباره همه فایل های سرویس ها رو بررسی میکنه و متوجه سرویسی که جدید ساختیم میشه.


# دستورات مرتبط با service ها در SystemD :


از اینجا به بعد چند تا دستور که در مدیریت کردن سرویس ها کاربرد داره رو بررسی می کنیم. در جلوی هر دستور باید اسم سرویس مورد نظر تون رو بنویسید.



 systemctl list-uint-files
 
 لیست همه سرویس هایی که روی سیستم شما وجود داره رو همراه با جزیات نشون میده.
 
 systemctl start
 
 systemctl stop
 
 با استفاده از start و stop میتونیم یک سرویس رو start یا stop کنیم.
 
 
 systemctl restart
 
 با استفاده از این دستور میتونیم سرویس رو restart بکنیم.
 
 systemctl enable
 
 systemctl disable
 
 با استفاده از enable و disable میتونیم تعیین کنیم که این سرویس در هنگام بوت شدن سیستم عامل به صورت خودکار اجرا بشه یا نشه. هر سرویسی enable بشه در زمان boot شدن سیستمبه طور خودکار اجرا میشه

